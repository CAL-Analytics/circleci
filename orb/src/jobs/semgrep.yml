description: >
  This job performs a semgrep scan and outputs a pretty report html file as a viewable artifact.

executor: semgrep

resource_class: medium

parameters:
  semgrep_exclude_rules:
    type: string
    default: ""
    description: "(Optional) space-separated list of semgrep rules to exclude."
    
steps:
  - checkout
  - semgrep:
      semgrep_exclude_rules: << parameters.semgrep_exclude_rules >>

  - jira/notify:
      environment: semgrep
      environment_type: development
      job_type: build
      pipeline_id: << pipeline.id >>
      pipeline_number: "<< pipeline.number >>"

  # - slack-notify:
  #     event: fail
  #     custom_message: "Failed :fire:"
  #     slack_thread_id: << parameters.slack_thread_id >>
  # - slack-notify:
  #     event: pass
  #     custom_message: "Success :champagne:"
  #     slack_thread_id: << parameters.slack_thread_id >>


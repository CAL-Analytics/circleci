description: >
  This command performs a CDK deploy to an environment.

parameters:
  cdk_env:
    type: string
    description: "This is the middle part of the properties file. i.e. dev, mgmt, pci.prod"
  cdk_lang:
    type: string
    default: python
    description: "What is the CDK language? defaults to python. typescript is the only other option for now."
  poetry_path:
    type: string
    default: ""
    description: "Path to poetry toml/lock file. Defaults to None, meaning it lives in the cdk root."
  poetry_install_cmd:
    type: string
    default: ""
    description: "Poetry install command. Defaults to: poetry install"

steps:
  - checkout
  - setup_remote_docker
  - set-up-cicd-env
  - run:
      environment:
        CDK_ENV: << parameters.cdk_env >>
        CDK_LANG: << parameters.cdk_lang >>
        POETRY_PATH: << parameters.poetry_path >>
        POETRY_INSTALL_CMD: << parameters.poetry_install_cmd >>
      name: CDK deploy
      # shell: /bin/xonsh -i
      command: cdk_deploy.py
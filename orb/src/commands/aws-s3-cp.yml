description: >
  AWS Helper command to copy files into an S3 bucket.

parameters:
  s3_bucket:
    type: string
    description: "s3 bucket name or SSM Parameter to find it. SSM Parameter should begin with /"
  s3_path:
    type: string
    description: "S3 Key path to sync local files into."
  sync_files:
    type: string
    description: "Local file or folder to sync into aws an s3 bucket."
  s3_metadata:
    type: string
    default: ""
    description: "Metadata to add to each file. i.e. key1=value1,key2=value2"
  s3_metadata_directive:
    type: string
    default: ""
    description: "Metadata Directive (ONLY used if metadata is set). Defaults to REPLACE. Can be COPY or REPLACE."
  s3_cache_control:
    type: string
    default: ""
    description: "Cache control to add to the files. i.e. max-age=86400"
  s3_content_type:
    type: string
    default: ""
    description: "Content type to add to the file. i.e. application/json"
  version_file:
    type: string
    default: ""
    description: "(Optional). Version the file with our get_version()"

steps:
  - set-up-unfurly-env
  - run:
      environment:
        S3_BUCKET: <<parameters.s3_bucket>>
        S3_PATH: <<parameters.s3_path>>
        SYNC_FILES: <<parameters.sync_files>>
        S3_METADATA: <<parameters.s3_metadata>>
        S3_METADATA_DIRECTIVE: <<parameters.s3_metadata_directive>>
        S3_CACHE_CONTROL: <<parameters.s3_cache_control>>
        S3_CONTENT_TYPE: <<parameters.s3_content_type>>
        VERSION_FILE: <<parameters.version_file>>
      name: s3 copy
      command: aws_s3_cp.py